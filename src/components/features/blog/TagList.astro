---
import Tag from "@/components/ui/Tag.astro";

interface Props {
  tags?: string[];
  omit?: boolean;
}

const { tags, omit = false } = Astro.props;

// タグの長さに応じて表示数を動的に決定
const calcMaxVisibleTags = (tags: string[]): number => {
  if (!tags || tags.length === 0) return 0;
  
  // タグの平均文字数を計算
  const totalLength = tags.reduce((sum, tag) => sum + tag.length, 0);
  const avgLength = totalLength / tags.length;
  
  // 文字数の平均から表示数を決める
  if (avgLength <= 4) {
    // 4文字以下: 4個表示
    return 4;
  } else if (avgLength <= 8) {
    // 5-8文字: 3個表示
    return 3;
  } else {
    // 9文字以上: 2個表示
    return 2;
  }
};

const maxVisibleTags = tags ? calcMaxVisibleTags(tags) : 0;
---

{tags && tags.length > 0 && (
  <>
    {omit ? (
      <>
        {tags.slice(0, maxVisibleTags).map((tag) => (
          <Tag useHashTag name={tag} />
        ))}
        {tags.length > maxVisibleTags && (
          <Tag name={`+${tags.length - maxVisibleTags}`} />
        )}
      </>
    ) : (
      <>
        {tags.map((tag) => (
          <Tag useHashTag name={tag} />
        ))}
      </>
    )}
  </>
)}