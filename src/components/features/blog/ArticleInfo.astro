---
import { Flex, VStack, styled as s } from "styled-system/jsx";
import dayjs from "dayjs";
import Icon from "astro-iconify";
import TagList from "./TagList.astro";
import { getReadingTime } from "@/lib/reading-time";

interface Props {
  title: string;
  publishDate?: string | Date;
  updateDate?: string | Date;
  tags?: string[];
  emoji?: string;
  description?: string;
  content?: string;
}

const {
  title,
  publishDate,
  updateDate,
  tags = [],
  emoji,
  description,
  content,
} = Astro.props;

const readingTime = content ? getReadingTime(content) : undefined;
---

<VStack
  alignItems="center"
  mb="8"
  gap="4"
>
  <!-- 絵文字 -->
  {emoji && (
    <Flex
      alignItems="center"
      justifyContent="center"
      fontSize={{ base: "7xl", lg: "8xl" }}
    >
      {emoji}
    </Flex>
  )}

  <!-- タイトル -->
  <s.h2
    fontSize={{ base: "1xl", sm: "2xl", md: "3xl", lg: "4xl" }}
    fontWeight="bold"
    textAlign="center"
    m="0"
    px={{ base: "4", sm: "6", md: "8" }}
    w="full"
    maxW="4xl"
    lineHeight={{ base: "tight", lg: "normal", xl: "snug" }}
    wordBreak="break-word"
    overflowWrap="break-word"
    hyphens="auto"
  >
    {title}
  </s.h1>

  <!-- タグ -->
  {tags.length > 0 && (
    <Flex
      justifyContent="center"
      alignItems="center"
      flexWrap="wrap"
      gap="2"
      mb="4"
    >
      <TagList tags={tags} />
    </Flex>
  )}

  <!-- メタデータ -->
  <s.div
    rounded="lg"
    w="full"
    maxW="2xl"
  >
    <Flex
      justifyContent="center"
      alignItems={{ base: "center", sm: "flex-start" }}
      flexWrap="wrap"
      gap={{ base: "4", sm: "6" }}
      fontSize="sm"
      color="sz.text.main"
    >
      <!-- 公開日 -->
      {publishDate && (
        <Flex alignItems="center" gap="1.5">
          <Icon name="mdi:calendar" size={16} />
          <span>{dayjs(publishDate).format("YYYY.MM.DD")}</span>
        </Flex>
      )}

      <!-- 更新日 -->
      {updateDate && (
        <Flex alignItems="center" gap="1.5">
          <Icon name="mdi:update" size={16} />
          <span>{dayjs(updateDate).format("YYYY.MM.DD")}</span>
        </Flex>
      )}

      <!-- 読了時間 -->
      {readingTime && (
        <Flex alignItems="center" gap="1.5">
          <Icon name="mdi:clock-outline" size={16} />
          <time>{readingTime}</time>
        </Flex>
      )}
    </Flex>
  </s.div>

  {description && (
    <s.p
      textAlign="center"
      lineHeight="relaxed"
      maxW="2xl"
      color="sz.text.main"
      px="4"
    >
      {description}
    </s.p>
  )}
</VStack>
