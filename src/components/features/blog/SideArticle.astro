---
import type { CollectionEntry } from "astro:content";
import { getCollection } from "astro:content";
import { Flex, Grid, HStack, styled as s } from "styled-system/jsx";
import { css } from "styled-system/css";
import Icon from "astro-iconify";

export interface Props {
  slug: string;
  collection?: 'blog' | 'product' | 'award';
}

const { slug, collection = 'blog' } = Astro.props as Props;

// 指定された collection の公開済みエントリを取得して日付でソート
let entries: any[];
switch (collection) {
  case 'blog':
    entries = await getCollection('blog');
    break;
  case 'product':
    entries = await getCollection('product');
    break;
  case 'award':
    entries = await getCollection('award');
    break;
  default:
    entries = await getCollection('blog');
}
const collectionEntries = entries
  .filter((entry) => entry.data?.isPublish)
  .sort((a, b) => {
    const aDate = a.data?.publishDate ?? a.data?.updateDate ?? new Date(0);
    const bDate = b.data?.publishDate ?? b.data?.updateDate ?? new Date(0);
    return bDate.getTime() - aDate.getTime();
  });

// 現在の記事のインデックスを取得
const currentIndex = collectionEntries.findIndex(
  (entry) => (entry.data?.slug ?? entry.id) === slug
);

// 前後の記事を取得
const prevArticle = currentIndex > 0 ? collectionEntries[currentIndex - 1] : null;
const nextArticle = currentIndex < collectionEntries.length - 1 ? collectionEntries[currentIndex + 1] : null;
---

<Grid
  as="nav"
  gridTemplateColumns={{ base: "1fr", md: "1fr 1fr" }}
  gap="4"
  mt="12"
  pt="8"
  borderTopWidth="1px"
  borderColor="sz.border/50"
>
  <!-- 前の記事 -->
  {nextArticle && (
    <a
      href={`/${collection}/${nextArticle?.data?.slug ?? nextArticle?.id}/`}
      class={css({
        display: "flex",
        flexDirection: "column",
        gap: "2",
        p: "4",
        borderRadius: "xl",
        borderWidth: "1",
        borderColor: "sz.border/50",
        bg: "sz.bg",
        transition: "all 0.3s",
        textDecoration: "none",
        textAlign: { base: "left", md: "right" },
        _hover: {
          borderColor: "sz.primary/50",
          bg: "sz.bg-on",
          shadow: "md",
          transform: "translateY(-2px)",
        },
      })}
    >
      <HStack
        gap="2"
        color="sz.text.sub"
        fontSize="sm"
        flexWrap="wrap"
        justify="flex-start"
      >
        <Icon name="mdi:chevron-left" size={20} />
        <span>前の記事</span>
        
      </HStack>
      <s.div
        color="sz.text.main"
        fontWeight="bold"
        lineHeight="snug"
        overflow="hidden"
        textOverflow="ellipsis"
        display="-webkit-box"
        style={{ WebkitLineClamp: 2, WebkitBoxOrient: "vertical" }}
      >
        {nextArticle?.data?.emoji && (
          <s.span mr="2">{nextArticle.data.emoji}</s.span>
        )}
        {nextArticle?.data?.title}
      </s.div>
    </a>
  )}

  <!-- 次の記事 -->
  {prevArticle && (
    <a
      href={`/${collection}/${prevArticle?.data?.slug ?? prevArticle?.id}/`}
      class={css({
        display: "flex",
        flexDirection: "column",
        gap: "2",
        p: "4",
        borderRadius: "xl",
        borderWidth: "1px",
        borderColor: "sz.border/50",
        bg: "sz.bg",
        transition: "all 0.3s",
        textDecoration: "none",
        gridColumn: { base: "1", md: "2" },
        _hover: {
          borderColor: "sz.primary/50",
          bg: "sz.bg-on",
          shadow: "md",
          transform: "translateY(-2px)",
        },
      })}
    >
      <HStack flexWrap="wrap" justify="flex-end" gap="2" color="sz.text.sub" fontSize="sm">
        <span>次の記事</span>
        <Icon name="mdi:chevron-right" size={20} />
      </HStack>
      <Flex
        color="sz.text.main"
        fontWeight="bold"
        lineHeight="snug"
        overflow="hidden"
        textOverflow="ellipsis"
        display="-webkit-box"
        style={{ WebkitLineClamp: 2, WebkitBoxOrient: "vertical" }}
      >
        {prevArticle?.data?.emoji && (
          <s.span mr="2">{prevArticle.data.emoji}</s.span>
        )}
        {prevArticle?.data?.title}
      </Flex>
    </a>
  )}
</Grid>