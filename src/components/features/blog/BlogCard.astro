---
import dayjs from "dayjs";
import { Flex, HStack, Center, styled as s } from "styled-system/jsx";
import { css, cx } from "styled-system/css";
import { flex, center } from "styled-system/patterns";
import { categories } from "@/consts/category";
import TagList from "./TagList.astro";
import { Card } from "@/components/ui/Card";
import Icon from "astro-iconify";
import { getReadingTime } from "@/lib/reading-time";

export interface Props {
  blog: {
    id: string;
    data: {
      title: string;
      slug?: string;
      emoji?: string;
      tags?: string[];
      category?: string;
      publishDate: Date;
      updateDate?: Date;
      content?: string;
    };
  };
}

const { blog } = Astro.props;

const currentCategory = categories.find((cat) => cat.category === blog.data.category);
const readingTime = blog.data.content ? getReadingTime(blog.data.content) : undefined;
---

<Card>
  <a
    href={`/blog/${blog.data.slug ?? blog.id}/`}
    class={cx(
      flex({ direction: "column", height: "full" }),
      css({ color: "sz.text.main", textDecoration: "none" })
    )}
  >
    <Flex
      position="relative"
      bgGradient="to-r"
      gradientFrom="sz.primary/5"
      gradientVia="sz.primary/10"
      gradientTo="sz.primary/5"
      p={{ base: "8", _sm: "6" }}
      pb={{ base: "6", _sm: "4" }}
      flex="1"
      flexDir="column"
    >
      <!-- ã‚«ãƒ¼ãƒ‰ãƒ˜ãƒƒãƒ€ãƒ¼ï¼šçµµæ–‡å­—èƒŒæ™¯ -->
      
      <s.div position="absolute" top="6" right="6" opacity="0.1" >
        <Center w="20" h="20" bg="sz.primary/10" borderRadius="full" >
          <div class={css({ fontSize: "3xl" })}>
            {currentCategory?.emoji || "ğŸ“"}
          </div>
        </Center>
      </s.div>
     

      <!-- ãƒ¡ã‚¤ãƒ³çµµæ–‡å­— -->
      <s.div position="relative" z="10">
        <Center
          w="16"
          h="16"
          bg="sz.bg"
          rounded="xl"
          shadow="md"
          transition="all 0.3s"
          _groupHover={{ transform: "scale(1.1) rotate(3deg)" }}
        >
          <s.span fontSize="3xl">{blog.data.emoji || "ğŸ“"}</s.span>
        </Center>
      </s.div>

    <!-- ã‚¿ã‚¤ãƒˆãƒ« -->
    <h2
      class={css({
        lineHeight: "snug",
        transition: "colors 0.3s",
        mb: "3",
        mt: "4",
          fontWeight: "bold",
          fontSize: "xl",
          overflow: "hidden",
          textOverflow: "ellipsis",
          display: "-webkit-box",
          lineClamp: "2",
          _groupHover: {
            color: "sz.primary",
          },
        })}
        style="-webkit-line-clamp: 2; -webkit-box-orient: vertical;"
      >
        {blog.data.title}
      </h2>

      <!-- ã‚¿ã‚° -->
      <Flex direction="column" flex="1" justify="space-between" >
        <HStack gap="2" mb="7">
          <TagList omit tags={blog.data.tags} />
        </HStack>

        <HStack
          justify="flex-end"
          borderTopWidth="1px"
          borderColor="sz.border/30"
          pt="3"
          gap="2"
        >
          <!-- èª­äº†æ™‚é–“ -->
          {readingTime && (
            <HStack gap="1">
              <Icon name="mdi:clock-outline" size={16} />
              <s.time color="sz.text.main" fontSize="sm">
                {readingTime}
              </s.time>
            </HStack>
          )}

          <!-- å…¬é–‹æ—¥ -->
          <HStack gap="1">
            <Icon name="mdi:calendar" size={16} />
            <s.time
              dateTime={blog.data.publishDate.toISOString()}
              color="sz.text.main"
              fontSize="sm"
            >
              {dayjs(blog.data.publishDate).format("YYYY.MM.DD")}
            </s.time>
          </HStack>
        </HStack>
      </Flex>
    </Flex>
  </a>
</Card>
