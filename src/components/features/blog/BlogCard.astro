---
import { Flex, HStack, Center, styled as s } from "styled-system/jsx";
import { css, cx } from "styled-system/css";
import { flex, center } from "styled-system/patterns";
import { categories } from "@/consts/category";
import TagList from "./TagList.astro";
import CategoryBadge from "./CategoryBadge.astro";
import { Card } from "@/components/ui/Card";
import ReadingTime from "@/components/shared/ReadingTime.astro";
import Date from "@/components/shared/Date.astro";
import BudouxText from "@/components/shared/BudouxText";

export interface Props {
	blog: {
		id: string;
		data: {
			title: string;
			slug?: string;
			emoji?: string;
			tags?: string[];
			category?: string;
			publishDate: Date;
			updateDate?: Date;
			content?: string;
		};
	};
}

const { blog } = Astro.props;

const currentCategory = categories.find(
	(cat) => cat.category === blog.data.category,
);
---

<Card maxW="450px">
  <s.a
    href={`/blog/${blog.data.slug ?? blog.id}/`}
    display="flex"
    direction="column"
    h="full"
    color="sz.text.main"
    textDecoration="none"
  >
    <Flex
      position="relative"
      bgGradient="to-r"
      gradientFrom="sz.primary/5"
      gradientVia="sz.primary/10"
      gradientTo="sz.primary/5"
      p={{ base: "8", _sm: "6" }}
      pb={{ base: "6", _sm: "4" }}
      flex="1"
      flexDir="column"
    >
      <!-- ã‚«ãƒ¼ãƒ‰ãƒ˜ãƒƒãƒ€ãƒ¼ï¼šçµµæ–‡å­—èƒŒæ™¯ -->

      <s.div position="absolute" top="6" right="6" opacity="0.1">
        <Center w="20" h="20" bg="sz.primary/10" borderRadius="full">
          <s.div fontSize="3xl">
            {currentCategory?.emoji || "ğŸ“"}
          </s.div>
        </Center>
      </s.div>

      <!-- ãƒ¡ã‚¤ãƒ³çµµæ–‡å­— -->
      <s.div position="relative" z="10">
        <Center
          w="16"
          h="16"
          bg="sz.bg"
          rounded="xl"
          shadow="md"
          transition="all 0.3s"
          _groupHover={{ transform: "scale(1.1) rotate(3deg)" }}
        >
          <s.span fontSize="3xl">{blog.data.emoji || "ğŸ“"}</s.span>
        </Center>
      </s.div>

      <s.h2
        lineHeight="snug"
        transition="colors 0.3s"
        mb="3"
        mt="4"
        fontWeight="bold"
        fontSize="xl"
        overflow="hidden"
        textOverflow="ellipsis"
        lineClamp="2"
        display="flex"
        flexWrap="wrap"
        gap="0.5"
        _groupHover={{ color: "sz.primary" }}
      >
        <BudouxText text={blog.data.title} client:load />
      </s.h2>

      <!-- ã‚¿ã‚° -->
      <Flex direction="column" flex="1" justify="space-between">
        <HStack gap="2" mb="7">
          <TagList omit tags={blog.data.tags} />
        </HStack>

        <HStack
          justify="space-between"
          borderTopWidth="1px"
          borderColor="sz.border/30"
          pt="3"
          gap="2"
        >
          <CategoryBadge category={blog.data.category} />

          <HStack gap="2" justify="flex-end" flex="1">
            <!-- èª­äº†æ™‚é–“ -->
            <ReadingTime content={blog.data.content || ""} gap="1" />

            <!-- å…¬é–‹æ—¥ -->
            <Date date={blog.data.publishDate || ""} gap="1" type="publish" />
          </HStack>
        </HStack>
      </Flex>
    </Flex>
  </s.a>
</Card>
